<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 6 Spatial data | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 6 Spatial data | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 6 Spatial data | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="visualization.html"/>
<link rel="next" href="analysis.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>1</b> Reading</a>
<ul>
<li class="chapter" data-level="1.1" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>1.1</b> CSV</a></li>
<li class="chapter" data-level="1.2" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>1.2</b> Excel</a></li>
<li class="chapter" data-level="1.3" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>1.3</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="1.4" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>1.4</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>2</b> Extraction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>2.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>3</b> Structuring</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>3.1</b> Inspecting the data</a></li>
<li class="chapter" data-level="3.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>3.2</b> Data types</a></li>
<li class="chapter" data-level="3.3" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>3.3</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="3.4" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>3.4</b> Changing cell values</a></li>
<li class="chapter" data-level="3.5" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>3.5</b> Pivoting the dataset</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>4</b> Cleaning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>4.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>4.2</b> Treating outliers</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>4.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>5.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="5.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>5.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="5.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>5.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="5.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>5.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>5.2</b> Animated graph with <code>gganimate</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>5.2.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>5.3</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>5.3.1</b> Input functions</a></li>
<li class="chapter" data-level="5.3.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>5.3.2</b> Output functions</a></li>
<li class="chapter" data-level="5.3.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>5.3.3</b> Server function</a></li>
<li class="chapter" data-level="5.3.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>5.3.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualization.html"><a href="visualization.html#more-dataviz-resources"><i class="fa fa-check"></i><b>5.4</b> More dataviz resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>6</b> Spatial data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>6.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>6.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>6.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>6.2</b> Processing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>6.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="6.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>6.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="6.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>6.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>6.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>6.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>7</b> Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>7.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>7.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="7.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>7.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>7.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>8</b> Resources</a>
<ul>
<li class="chapter" data-level="8.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>8.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial" class="section level1" number="6">
<h1><span class="header-section-number">Section 6</span> Spatial data</h1>
<p>In R, spatial data format such as shapefile, geodatabase, geojson, etc. can be read and processed as a dataframe just like common data formats (csv, excel, etc.). However, we have to use special libraries to do so. In addition, because of the nature of this data, spatial relationship operations can also be performed to join or create new features. In this tutorial, we’ll make some examples using the <code>sf</code> and <code>raster</code> libraries.</p>
<div id="importing-spatial-data" class="section level2" number="6.1">
<h2><span class="header-section-number">6.1</span> Importing spatial data</h2>
<p>Spatial data have many formats and the most commonly used is <code>shapefile</code> for vectors and <code>tiff</code> for rasters. This tutorial will focus on these 2 types of data.</p>
<div id="reading-shapefile" class="section level3" number="6.1.1">
<h3><span class="header-section-number">6.1.1</span> Reading shapefile</h3>
<p>The shapefile format consists of at least 3 files: the main file (.shp), the index file (.shx), and the table file (.dbf). Sometimes there is also a projection file (.prj). Please visit <a href="https://www.loc.gov/preservation/digital/formats/fdd/fdd000280.shtml">this webpage</a> for more details.
Because of this file structure, it is good practice to save shapefile in a folder or .zip file. And when reading the data in R, we simply point to the <code>.shp</code> file in the folder.</p>
<pre><code>## Linking to GEOS 3.7.2, GDAL 2.4.2, PROJ 5.2.0</code></pre>
<pre><code>## tibble [27,459 × 11] (S3: sf/tbl_df/tbl/data.frame)
##  $ ID        : int [1:27459] 1 2 3 4 5 6 7 8 9 10 ...
##  $ TSEVENT_ID: int [1:27459] 3 9 10 10 10 10 10 11 27 27 ...
##  $ YEAR      : int [1:27459] -1610 -479 -426 -426 -426 -426 -426 -373 142 142 ...
##  $ MONTH     : int [1:27459] NA NA 6 6 6 6 6 NA NA NA ...
##  $ DAY       : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ DATE_STRIN: chr [1:27459] &quot;-1610/??/??&quot; &quot;-0479/??/??&quot; &quot;-0426/06/??&quot; &quot;-0426/06/??&quot; ...
##  $ ARR_DAY   : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ ARR_HOUR  : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ ARR_MIN   : int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ TRAV_HOURS: int [1:27459] NA NA NA NA NA NA NA NA NA NA ...
##  $ geometry  :sfc_POINT of length 27459; first list element:  &#39;XY&#39; num [1:2] 2782987 4232038
##  - attr(*, &quot;sf_column&quot;)= chr &quot;geometry&quot;
##  - attr(*, &quot;agr&quot;)= Factor w/ 3 levels &quot;constant&quot;,&quot;aggregate&quot;,..: NA NA NA NA NA NA NA NA NA NA
##   ..- attr(*, &quot;names&quot;)= chr [1:10] &quot;ID&quot; &quot;TSEVENT_ID&quot; &quot;YEAR&quot; &quot;MONTH&quot; ...</code></pre>
<p>When looking at the dataframe structure above, we can see that the shapefile is processed similarly to a regular dataframe, except for the additional <code>geometry</code> field which contain the spatial information.</p>
<p>If we want to plot this data, we can simply use the base <code>plot</code> function.</p>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb116-1"><a href="spatial.html#cb116-1"></a><span class="co"># a plot of the first 4 columns</span></span>
<span id="cb116-2"><a href="spatial.html#cb116-2"></a><span class="co"># plotted as location</span></span>
<span id="cb116-3"><a href="spatial.html#cb116-3"></a><span class="kw">plot</span>(tsunami[, <span class="dv">1</span><span class="op">:</span><span class="dv">4</span>])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-1.png" width="672" /></p>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb117-1"><a href="spatial.html#cb117-1"></a><span class="co"># a plot of only columns</span></span>
<span id="cb117-2"><a href="spatial.html#cb117-2"></a><span class="co"># plotted as values without geometry</span></span>
<span id="cb117-3"><a href="spatial.html#cb117-3"></a><span class="kw">plot</span>(tsunami<span class="op">$</span>DEATHS)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-2.png" width="672" /></p>
<div class="sourceCode" id="cb118"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb118-1"><a href="spatial.html#cb118-1"></a><span class="kw">plot</span>(tsunami<span class="op">$</span>LONGITUDE, tsunami<span class="op">$</span>DIST_FROM_)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-2-3.png" width="672" /></p>
<p>If you only want to plot the geometry (points):</p>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb119-1"><a href="spatial.html#cb119-1"></a><span class="kw">plot</span>(<span class="kw">st_geometry</span>(tsunami))</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-3-1.png" width="672" /></p>
</div>
<div id="reading-raster" class="section level3" number="6.1.2">
<h3><span class="header-section-number">6.1.2</span> Reading raster</h3>
<p>Raster <code>.tif</code> files can be imported with the <code>raster</code> library.</p>
<div class="sourceCode" id="cb120"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb120-1"><a href="spatial.html#cb120-1"></a><span class="kw">library</span>(raster)</span>
<span id="cb120-2"><a href="spatial.html#cb120-2"></a>wind_jan &lt;-<span class="st"> </span><span class="kw">raster</span>(<span class="st">&#39;data/wc2.1_10m_wind/wc2.1_10m_wind_01.tif&#39;</span>)</span>
<span id="cb120-3"><a href="spatial.html#cb120-3"></a><span class="kw">plot</span>(wind_jan)</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-4-1.png" width="672" /></p>
</div>
</div>
<div id="processing" class="section level2" number="6.2">
<h2><span class="header-section-number">6.2</span> Processing</h2>
<div id="creating-point-data" class="section level3" number="6.2.1">
<h3><span class="header-section-number">6.2.1</span> Creating point data</h3>
<p>This example shows how to convert a data with latitude, longitude coordinates to a spatial dataframe. We’ll use the charcoal records from the <code>GCD</code> package as example.</p>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb121-1"><a href="spatial.html#cb121-1"></a><span class="kw">library</span>(GCD)</span>
<span id="cb121-2"><a href="spatial.html#cb121-2"></a><span class="kw">data</span>(<span class="st">&quot;paleofiresites&quot;</span>)</span>
<span id="cb121-3"><a href="spatial.html#cb121-3"></a>df.table &lt;-<span class="st"> </span>paleofiresites</span>
<span id="cb121-4"><a href="spatial.html#cb121-4"></a>wgs84crs &lt;-<span class="st"> </span><span class="dv">4269</span></span>
<span id="cb121-5"><a href="spatial.html#cb121-5"></a>sf.table &lt;-<span class="st"> </span><span class="kw">st_as_sf</span>(df.table, <span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span>wgs84crs, <span class="dt">remove=</span>F)</span></code></pre></div>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb122-1"><a href="spatial.html#cb122-1"></a><span class="co"># non spatial data</span></span>
<span id="cb122-2"><a href="spatial.html#cb122-2"></a><span class="kw">plot</span>(df.table[,<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">11</span><span class="op">:</span><span class="dv">13</span>)])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-6-1.png" width="672" /></p>
<div class="sourceCode" id="cb123"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb123-1"><a href="spatial.html#cb123-1"></a><span class="co"># spatial data</span></span>
<span id="cb123-2"><a href="spatial.html#cb123-2"></a><span class="kw">plot</span>(sf.table[,<span class="kw">c</span>(<span class="dv">7</span>,<span class="dv">11</span><span class="op">:</span><span class="dv">13</span>)])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-6-2.png" width="672" /></p>
</div>
<div id="joining-with-another-dataframe" class="section level3" number="6.2.2">
<h3><span class="header-section-number">6.2.2</span> Joining with another dataframe</h3>
<p>Oftentimes, we want to join a non-spatial data with their geographic location. For example, if we have information on <a href="https://www.eia.gov/state/">energy production and consumption by state</a>, we can join it with spatial feature for better visualization.</p>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb124-1"><a href="spatial.html#cb124-1"></a><span class="co"># get energy data</span></span>
<span id="cb124-2"><a href="spatial.html#cb124-2"></a>energy.data &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="st">&#39;data/energy-by_state.csv&#39;</span>)</span>
<span id="cb124-3"><a href="spatial.html#cb124-3"></a></span>
<span id="cb124-4"><a href="spatial.html#cb124-4"></a><span class="co"># use USABoundaries library to get US spatial data</span></span>
<span id="cb124-5"><a href="spatial.html#cb124-5"></a><span class="kw">library</span>(USAboundaries)</span>
<span id="cb124-6"><a href="spatial.html#cb124-6"></a>us.geo &lt;-<span class="st"> </span><span class="kw">us_states</span>(<span class="dt">resolution=</span><span class="st">&#39;low&#39;</span>)</span>
<span id="cb124-7"><a href="spatial.html#cb124-7"></a>joined.data &lt;-<span class="st"> </span>us.geo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">inner_join</span>(energy.data, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;state_abbr&#39;</span>=<span class="st">&#39;State&#39;</span>))</span>
<span id="cb124-8"><a href="spatial.html#cb124-8"></a>joined.data.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(joined.data, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb124-9"><a href="spatial.html#cb124-9"></a><span class="kw">plot</span>(joined.data.albers[,<span class="st">&#39;Production..U.S..Share&#39;</span>])</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-7-1.png" width="672" /></p>
</div>
<div id="spatial-joining" class="section level3" number="6.2.3">
<h3><span class="header-section-number">6.2.3</span> Spatial joining</h3>
<p>If we look at the <code>paleofiresites</code> data, we can see that we don’t have the US state corresponding to each point location. We can create this variable with spatial join.</p>
<div class="sourceCode" id="cb125"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb125-1"><a href="spatial.html#cb125-1"></a><span class="co"># get paleo sites for the US</span></span>
<span id="cb125-2"><a href="spatial.html#cb125-2"></a>us.paleo &lt;-<span class="st"> </span>paleofiresites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(country<span class="op">==</span><span class="st">&#39;USA&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb125-3"><a href="spatial.html#cb125-3"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span>wgs84crs)</span>
<span id="cb125-4"><a href="spatial.html#cb125-4"></a><span class="co"># set to the same coordinate system</span></span>
<span id="cb125-5"><a href="spatial.html#cb125-5"></a>us.paleo.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(us.paleo, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb125-6"><a href="spatial.html#cb125-6"></a>us.geo.albers &lt;-<span class="st"> </span><span class="kw">st_transform</span>(us.geo, <span class="dt">crs=</span><span class="dv">5070</span>)</span>
<span id="cb125-7"><a href="spatial.html#cb125-7"></a><span class="co"># spatial join</span></span>
<span id="cb125-8"><a href="spatial.html#cb125-8"></a><span class="co"># here we join by within</span></span>
<span id="cb125-9"><a href="spatial.html#cb125-9"></a>sp.join &lt;-<span class="st"> </span><span class="kw">st_join</span>(us.paleo.albers, us.geo.albers, <span class="dt">join=</span>st_within)</span>
<span id="cb125-10"><a href="spatial.html#cb125-10"></a>{<span class="kw">plot</span>(<span class="kw">st_geometry</span>(us.geo.albers))</span>
<span id="cb125-11"><a href="spatial.html#cb125-11"></a><span class="kw">plot</span>(sp.join[, <span class="st">&#39;state_name&#39;</span>], <span class="dt">add=</span>T, <span class="dt">pch=</span><span class="dv">16</span>)}</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-8-1.png" width="672" /></p>
<p>For more on what you can do with a vector files in r, please visit <code>sf</code> <a href="https://r-spatial.github.io/sf/reference/index.html">library reference</a> or read the book <a href="https://geocompr.robinlovelace.net/">Geocomputation with R</a>.</p>
</div>
</div>
<div id="some-visualization-examples" class="section level2" number="6.3">
<h2><span class="header-section-number">6.3</span> Some Visualization Examples</h2>
<div id="plotting-charcoal-data" class="section level3" number="6.3.1">
<h3><span class="header-section-number">6.3.1</span> Plotting charcoal data</h3>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb126-1"><a href="spatial.html#cb126-1"></a><span class="co"># get world map from rnaturalearth library</span></span>
<span id="cb126-2"><a href="spatial.html#cb126-2"></a><span class="kw">library</span>(rnaturalearth)</span>
<span id="cb126-3"><a href="spatial.html#cb126-3"></a>world &lt;-<span class="st"> </span><span class="kw">ne_countries</span>(<span class="dt">scale=</span><span class="st">&#39;small&#39;</span>, <span class="dt">returnclass=</span><span class="st">&#39;sf&#39;</span>)</span>
<span id="cb126-4"><a href="spatial.html#cb126-4"></a><span class="co"># project to robinson projection</span></span>
<span id="cb126-5"><a href="spatial.html#cb126-5"></a>sf.world.robin &lt;-<span class="st"> </span><span class="kw">st_transform</span>(world, <span class="dt">crs=</span><span class="st">&#39;+proj=robin&#39;</span>)</span>
<span id="cb126-6"><a href="spatial.html#cb126-6"></a></span>
<span id="cb126-7"><a href="spatial.html#cb126-7"></a><span class="co"># use imported graticule data for viz</span></span>
<span id="cb126-8"><a href="spatial.html#cb126-8"></a>grat &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(<span class="kw">read_sf</span>(<span class="st">&#39;data/ne_110m_graticules_all/ne_110m_wgs84_bounding_box.shp&#39;</span>))</span>
<span id="cb126-9"><a href="spatial.html#cb126-9"></a></span>
<span id="cb126-10"><a href="spatial.html#cb126-10"></a><span class="co"># get paleo sites</span></span>
<span id="cb126-11"><a href="spatial.html#cb126-11"></a>paleosites &lt;-<span class="st"> </span>paleofiresites <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-12"><a href="spatial.html#cb126-12"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">site_name =</span> <span class="kw">trimws</span>(<span class="kw">as.character</span>(site_name))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-13"><a href="spatial.html#cb126-13"></a><span class="st">  </span><span class="kw">st_as_sf</span>(<span class="dt">coords=</span><span class="kw">c</span>(<span class="st">&#39;long&#39;</span>, <span class="st">&#39;lat&#39;</span>), <span class="dt">crs=</span><span class="dv">4326</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb126-14"><a href="spatial.html#cb126-14"></a><span class="st">  </span><span class="kw">st_transform</span>(<span class="dt">crs=</span><span class="st">&#39;+proj=robin&#39;</span>)</span>
<span id="cb126-15"><a href="spatial.html#cb126-15"></a>newCoods &lt;-<span class="st"> </span><span class="kw">st_coordinates</span>(paleosites)</span>
<span id="cb126-16"><a href="spatial.html#cb126-16"></a>paleosites<span class="op">$</span>Lon &lt;-<span class="st"> </span>newCoods[,<span class="dv">1</span>]</span>
<span id="cb126-17"><a href="spatial.html#cb126-17"></a>paleosites<span class="op">$</span>Lat &lt;-<span class="st"> </span>newCoods[,<span class="dv">2</span>]</span>
<span id="cb126-18"><a href="spatial.html#cb126-18"></a></span>
<span id="cb126-19"><a href="spatial.html#cb126-19"></a><span class="co"># set ggplot theme</span></span>
<span id="cb126-20"><a href="spatial.html#cb126-20"></a><span class="kw">library</span>(ggplot2)</span>
<span id="cb126-21"><a href="spatial.html#cb126-21"></a><span class="kw">library</span>(ggrepel)</span>
<span id="cb126-22"><a href="spatial.html#cb126-22"></a>ggTheme &lt;-<span class="st"> </span><span class="kw">theme</span>(</span>
<span id="cb126-23"><a href="spatial.html#cb126-23"></a>  <span class="dt">legend.position=</span><span class="st">&#39;none&#39;</span>,</span>
<span id="cb126-24"><a href="spatial.html#cb126-24"></a>  <span class="dt">panel.grid.minor =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-25"><a href="spatial.html#cb126-25"></a>  <span class="dt">panel.grid.major =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-26"><a href="spatial.html#cb126-26"></a>  <span class="dt">panel.background =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-27"><a href="spatial.html#cb126-27"></a>  <span class="dt">plot.background =</span> <span class="kw">element_rect</span>(<span class="dt">fill=</span><span class="st">&#39;#e6e8ed&#39;</span>),</span>
<span id="cb126-28"><a href="spatial.html#cb126-28"></a>  <span class="dt">panel.border =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-29"><a href="spatial.html#cb126-29"></a>  <span class="dt">axis.line =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-30"><a href="spatial.html#cb126-30"></a>  <span class="dt">axis.text.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-31"><a href="spatial.html#cb126-31"></a>  <span class="dt">axis.text.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-32"><a href="spatial.html#cb126-32"></a>  <span class="dt">axis.ticks =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-33"><a href="spatial.html#cb126-33"></a>  <span class="dt">axis.title.x =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-34"><a href="spatial.html#cb126-34"></a>  <span class="dt">axis.title.y =</span> <span class="kw">element_blank</span>(),</span>
<span id="cb126-35"><a href="spatial.html#cb126-35"></a>  <span class="dt">plot.title =</span> <span class="kw">element_text</span>(<span class="dt">size=</span><span class="dv">22</span>)</span>
<span id="cb126-36"><a href="spatial.html#cb126-36"></a>)</span>
<span id="cb126-37"><a href="spatial.html#cb126-37"></a></span>
<span id="cb126-38"><a href="spatial.html#cb126-38"></a><span class="co"># few sites to be highlighted</span></span>
<span id="cb126-39"><a href="spatial.html#cb126-39"></a>selected.sites &lt;-<span class="st"> </span><span class="kw">c</span>(</span>
<span id="cb126-40"><a href="spatial.html#cb126-40"></a>  <span class="st">&#39;Little Molas Lake&#39;</span>,<span class="st">&#39;Xindi&#39;</span>,<span class="st">&#39;Laguna Oprasa&#39;</span>,<span class="st">&#39;Morro de Itapeva&#39;</span>,</span>
<span id="cb126-41"><a href="spatial.html#cb126-41"></a>  <span class="st">&#39;Aracatuba&#39;</span>, <span class="st">&#39;Lago del Greppo&#39;</span>,<span class="st">&#39;Nursery Swamp&#39;</span>, <span class="st">&#39;Huguangyan Maar Lake&#39;</span></span>
<span id="cb126-42"><a href="spatial.html#cb126-42"></a>)</span>
<span id="cb126-43"><a href="spatial.html#cb126-43"></a></span>
<span id="cb126-44"><a href="spatial.html#cb126-44"></a><span class="co"># mapping</span></span>
<span id="cb126-45"><a href="spatial.html#cb126-45"></a>map &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data=</span>sf.world.robin) <span class="op">+</span></span>
<span id="cb126-46"><a href="spatial.html#cb126-46"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">data=</span>grat, <span class="dt">fill=</span><span class="st">&#39;white&#39;</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>) <span class="op">+</span></span>
<span id="cb126-47"><a href="spatial.html#cb126-47"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="dt">fill=</span><span class="st">&#39;#c1cdcd&#39;</span>, <span class="dt">size=</span>.<span class="dv">1</span>, <span class="dt">color=</span><span class="st">&#39;white&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb126-48"><a href="spatial.html#cb126-48"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb126-49"><a href="spatial.html#cb126-49"></a>    <span class="dt">data=</span>paleosites,</span>
<span id="cb126-50"><a href="spatial.html#cb126-50"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat), <span class="dt">color=</span><span class="st">&#39;#009ACD&#39;</span>,<span class="dt">size=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb126-51"><a href="spatial.html#cb126-51"></a><span class="st">  </span><span class="kw">geom_point</span>(</span>
<span id="cb126-52"><a href="spatial.html#cb126-52"></a>    <span class="dt">data=</span>paleosites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site_name <span class="op">%in%</span><span class="st"> </span>selected.sites),</span>
<span id="cb126-53"><a href="spatial.html#cb126-53"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat), <span class="dt">color=</span><span class="st">&#39;#FF0000&#39;</span>,<span class="dt">size=</span><span class="dv">2</span>) <span class="op">+</span></span>
<span id="cb126-54"><a href="spatial.html#cb126-54"></a><span class="st">  </span><span class="kw">geom_text_repel</span>(</span>
<span id="cb126-55"><a href="spatial.html#cb126-55"></a>    <span class="dt">data=</span>paleosites <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(site_name <span class="op">%in%</span><span class="st"> </span>selected.sites),</span>
<span id="cb126-56"><a href="spatial.html#cb126-56"></a>    <span class="kw">aes</span>(<span class="dt">x=</span>Lon, <span class="dt">y=</span>Lat, <span class="dt">label=</span>site_name),</span>
<span id="cb126-57"><a href="spatial.html#cb126-57"></a>    <span class="dt">color=</span><span class="st">&#39;#000000&#39;</span>,</span>
<span id="cb126-58"><a href="spatial.html#cb126-58"></a>    <span class="dt">size=</span><span class="dv">4</span>) <span class="op">+</span></span>
<span id="cb126-59"><a href="spatial.html#cb126-59"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">datum=</span><span class="kw">st_crs</span>(<span class="dv">54030</span>)) <span class="op">+</span></span>
<span id="cb126-60"><a href="spatial.html#cb126-60"></a><span class="st">  </span>ggTheme</span>
<span id="cb126-61"><a href="spatial.html#cb126-61"></a></span>
<span id="cb126-62"><a href="spatial.html#cb126-62"></a>map</span></code></pre></div>
<p><img src="edsy_files/figure-html/spatial-9-1.png" width="672" /></p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="visualization.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/06-spatial.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
