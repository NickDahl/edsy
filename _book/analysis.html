<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Section 7 Analysis | EDS Vignettes</title>
  <meta name="description" content="Data science resources for FES Students" />
  <meta name="generator" content="bookdown 0.19 and GitBook 2.6.7" />

  <meta property="og:title" content="Section 7 Analysis | EDS Vignettes" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Data science resources for FES Students" />
  <meta name="github-repo" content="rajaoberison/edsy" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Section 7 Analysis | EDS Vignettes" />
  
  <meta name="twitter:description" content="Data science resources for FES Students" />
  

<meta name="author" content="Andry Rajaoberison" />


<meta name="date" content="2020-06-24" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="spatial.html"/>
<link rel="next" href="resources.html"/>
<script src="libs/header-attrs-2.2/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<script src="libs/plotly-binding-4.9.2.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/crosstalk-1.1.0.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.0.1/js/crosstalk.min.js"></script>
<link href="libs/plotly-htmlwidgets-css-1.52.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotly-main-1.52.2/plotly-latest.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; } /* Alert */
code span.an { color: #008000; } /* Annotation */
code span.at { } /* Attribute */
code span.bu { } /* BuiltIn */
code span.cf { color: #0000ff; } /* ControlFlow */
code span.ch { color: #008080; } /* Char */
code span.cn { } /* Constant */
code span.co { color: #008000; } /* Comment */
code span.cv { color: #008000; } /* CommentVar */
code span.do { color: #008000; } /* Documentation */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.im { } /* Import */
code span.in { color: #008000; } /* Information */
code span.kw { color: #0000ff; } /* Keyword */
code span.op { } /* Operator */
code span.ot { color: #ff4000; } /* Other */
code span.pp { color: #ff4000; } /* Preprocessor */
code span.sc { color: #008080; } /* SpecialChar */
code span.ss { color: #008080; } /* SpecialString */
code span.st { color: #008080; } /* String */
code span.va { } /* Variable */
code span.vs { color: #008080; } /* VerbatimString */
code span.wa { color: #008000; font-weight: bold; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">FES EDS Tutorials</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Prerequisites</a></li>
<li class="chapter" data-level="1" data-path="reading.html"><a href="reading.html"><i class="fa fa-check"></i><b>1</b> Reading</a>
<ul>
<li class="chapter" data-level="1.1" data-path="reading.html"><a href="reading.html#csv"><i class="fa fa-check"></i><b>1.1</b> CSV</a></li>
<li class="chapter" data-level="1.2" data-path="reading.html"><a href="reading.html#excel"><i class="fa fa-check"></i><b>1.2</b> Excel</a></li>
<li class="chapter" data-level="1.3" data-path="reading.html"><a href="reading.html#google-spreadsheets"><i class="fa fa-check"></i><b>1.3</b> Google Spreadsheets</a></li>
<li class="chapter" data-level="1.4" data-path="reading.html"><a href="reading.html#spss"><i class="fa fa-check"></i><b>1.4</b> SPSS</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="extraction.html"><a href="extraction.html"><i class="fa fa-check"></i><b>2</b> Extraction</a>
<ul>
<li class="chapter" data-level="2.1" data-path="extraction.html"><a href="extraction.html#web-scraping"><i class="fa fa-check"></i><b>2.1</b> Web Scraping</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="structuring.html"><a href="structuring.html"><i class="fa fa-check"></i><b>3</b> Structuring</a>
<ul>
<li class="chapter" data-level="3.1" data-path="structuring.html"><a href="structuring.html#inspecting-the-data"><i class="fa fa-check"></i><b>3.1</b> Inspecting the data</a></li>
<li class="chapter" data-level="3.2" data-path="structuring.html"><a href="structuring.html#data-types"><i class="fa fa-check"></i><b>3.2</b> Data types</a></li>
<li class="chapter" data-level="3.3" data-path="structuring.html"><a href="structuring.html#subsetting-and-filtering"><i class="fa fa-check"></i><b>3.3</b> Subsetting and Filtering</a></li>
<li class="chapter" data-level="3.4" data-path="structuring.html"><a href="structuring.html#changing-cell-values"><i class="fa fa-check"></i><b>3.4</b> Changing cell values</a></li>
<li class="chapter" data-level="3.5" data-path="structuring.html"><a href="structuring.html#pivoting-the-dataset"><i class="fa fa-check"></i><b>3.5</b> Pivoting the dataset</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="cleaning.html"><a href="cleaning.html"><i class="fa fa-check"></i><b>4</b> Cleaning</a>
<ul>
<li class="chapter" data-level="4.1" data-path="cleaning.html"><a href="cleaning.html#fixing-skewed-distribution"><i class="fa fa-check"></i><b>4.1</b> Fixing skewed distribution</a></li>
<li class="chapter" data-level="4.2" data-path="cleaning.html"><a href="cleaning.html#treating-outliers"><i class="fa fa-check"></i><b>4.2</b> Treating outliers</a></li>
<li class="chapter" data-level="4.3" data-path="cleaning.html"><a href="cleaning.html#fixing-missing-values"><i class="fa fa-check"></i><b>4.3</b> Fixing missing values</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="visualization.html"><a href="visualization.html"><i class="fa fa-check"></i><b>5</b> Visualization</a>
<ul>
<li class="chapter" data-level="5.1" data-path="visualization.html"><a href="visualization.html#simple-graphs-with-ggplot2"><i class="fa fa-check"></i><b>5.1</b> Simple graphs with <code>ggplot2</code></a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="visualization.html"><a href="visualization.html#setting-ggplot2-theme"><i class="fa fa-check"></i><b>5.1.1</b> Setting <code>ggplot2</code> theme</a></li>
<li class="chapter" data-level="5.1.2" data-path="visualization.html"><a href="visualization.html#ggplot2-example-1-stacked-bar-plot"><i class="fa fa-check"></i><b>5.1.2</b> <code>ggplot2</code> Example 1: Stacked bar plot</a></li>
<li class="chapter" data-level="5.1.3" data-path="visualization.html"><a href="visualization.html#ggplot2-example-2-grouped-bar-plot"><i class="fa fa-check"></i><b>5.1.3</b> <code>ggplot2</code> Example 2: Grouped bar plot</a></li>
<li class="chapter" data-level="5.1.4" data-path="visualization.html"><a href="visualization.html#ggplot2-example-3-scatterplot"><i class="fa fa-check"></i><b>5.1.4</b> <code>ggplot2</code> Example 3: Scatterplot</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="visualization.html"><a href="visualization.html#animated-graph-with-gganimate"><i class="fa fa-check"></i><b>5.2</b> Animated graph with <code>gganimate</code></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="visualization.html"><a href="visualization.html#plotly-example-1-interactive-version-of-the-stacked-bar"><i class="fa fa-check"></i><b>5.2.1</b> <code>plotly</code> Example 1: Interactive version of the stacked bar</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="visualization.html"><a href="visualization.html#web-app-with-rshiny"><i class="fa fa-check"></i><b>5.3</b> Web app with RShiny</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="visualization.html"><a href="visualization.html#input-functions"><i class="fa fa-check"></i><b>5.3.1</b> Input functions</a></li>
<li class="chapter" data-level="5.3.2" data-path="visualization.html"><a href="visualization.html#output-functions"><i class="fa fa-check"></i><b>5.3.2</b> Output functions</a></li>
<li class="chapter" data-level="5.3.3" data-path="visualization.html"><a href="visualization.html#server-function"><i class="fa fa-check"></i><b>5.3.3</b> Server function</a></li>
<li class="chapter" data-level="5.3.4" data-path="visualization.html"><a href="visualization.html#sharing-your-app"><i class="fa fa-check"></i><b>5.3.4</b> Sharing your app</a></li>
</ul></li>
<li class="chapter" data-level="5.4" data-path="visualization.html"><a href="visualization.html#more-dataviz-resources"><i class="fa fa-check"></i><b>5.4</b> More dataviz resources</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial.html"><a href="spatial.html"><i class="fa fa-check"></i><b>6</b> Spatial data</a>
<ul>
<li class="chapter" data-level="6.1" data-path="spatial.html"><a href="spatial.html#importing-spatial-data"><i class="fa fa-check"></i><b>6.1</b> Importing spatial data</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="spatial.html"><a href="spatial.html#reading-shapefile"><i class="fa fa-check"></i><b>6.1.1</b> Reading shapefile</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatial.html"><a href="spatial.html#reading-raster"><i class="fa fa-check"></i><b>6.1.2</b> Reading raster</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatial.html"><a href="spatial.html#processing"><i class="fa fa-check"></i><b>6.2</b> Processing</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="spatial.html"><a href="spatial.html#creating-point-data"><i class="fa fa-check"></i><b>6.2.1</b> Creating point data</a></li>
<li class="chapter" data-level="6.2.2" data-path="spatial.html"><a href="spatial.html#joining-with-another-dataframe"><i class="fa fa-check"></i><b>6.2.2</b> Joining with another dataframe</a></li>
<li class="chapter" data-level="6.2.3" data-path="spatial.html"><a href="spatial.html#spatial-joining"><i class="fa fa-check"></i><b>6.2.3</b> Spatial joining</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="spatial.html"><a href="spatial.html#some-visualization-examples"><i class="fa fa-check"></i><b>6.3</b> Some Visualization Examples</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="spatial.html"><a href="spatial.html#plotting-charcoal-data"><i class="fa fa-check"></i><b>6.3.1</b> Plotting charcoal data</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="analysis.html"><a href="analysis.html"><i class="fa fa-check"></i><b>7</b> Analysis</a>
<ul>
<li class="chapter" data-level="7.1" data-path="analysis.html"><a href="analysis.html#working-with-survey-data"><i class="fa fa-check"></i><b>7.1</b> Working with survey data</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="analysis.html"><a href="analysis.html#variable-standardization"><i class="fa fa-check"></i><b>7.1.1</b> Variable Standardization</a></li>
<li class="chapter" data-level="7.1.2" data-path="analysis.html"><a href="analysis.html#sample-weighting"><i class="fa fa-check"></i><b>7.1.2</b> Sample weighting</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="analysis.html"><a href="analysis.html#working-with-covid-19-data"><i class="fa fa-check"></i><b>7.2</b> Working with COVID-19 data</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="resources.html"><a href="resources.html"><i class="fa fa-check"></i><b>8</b> Resources</a>
<ul>
<li class="chapter" data-level="8.1" data-path="resources.html"><a href="resources.html#data"><i class="fa fa-check"></i><b>8.1</b> Data</a></li>
<li class="chapter" data-level="8.2" data-path="resources.html"><a href="resources.html#eds-course-map"><i class="fa fa-check"></i><b>8.2</b> EDS Course Map</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">EDS Vignettes</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="analysis" class="section level1" number="7">
<h1><span class="header-section-number">Section 7</span> Analysis</h1>
<div id="working-with-survey-data" class="section level2" number="7.1">
<h2><span class="header-section-number">7.1</span> Working with survey data</h2>
<p>We’ll use a survey <a href="https://osf.io/79t2k/">data</a> from a study of approach to engage christians in the issue of global warming. Using this data allow us to compare our results with the original. In this exercise, we’ll replicate the application of sampling weights and the standardization of variables which are common treatments of raw survey data.</p>
<pre><code>## Selected variables</code></pre>
<pre><code>## # A tibble: 13 x 2
##    V1          V2                                                               
##    &lt;chr&gt;       &lt;chr&gt;                                                            
##  1 subjID      &quot;Participant ID                                                 …
##  2 GWHap       &quot;On a scale from 1 to 7, how strongly do you believe that global…
##  3 GWworry     &quot;How worried are you about global warming?                      …
##  4 ex_ppgender &quot;What is your gender?                                           …
##  5 ex_ppage    &quot;What is your age?                                              …
##  6 raceCat     &quot;Race                                                           …
##  7 ex_ppstaten &quot;What U.S. State do you live in? Or do you live in a U.S. Territ…
##  8 moral_pre   &quot;TOPIC 10: THE ENVIRONMENT\nIn your opinion, how much do you thi…
##  9 relig_pre   &quot;TOPIC 10: THE ENVIRONMENT\nIn your opinion, how much do you thi…
## 10 health_pre  &quot;TOPIC 10: THE ENVIRONMENT\nIn your opinion, how much do you thi…
## 11 moral_post  &quot;In your opinion, how much do you think environmental protection…
## 12 relig_post  &quot;In your opinion, how much do you think environmental protection…
## 13 health_post &quot;In your opinion, how much do you think environmental protection…</code></pre>
<div id="variable-standardization" class="section level3" number="7.1.1">
<h3><span class="header-section-number">7.1.1</span> Variable Standardization</h3>
<p>Standardizing variables must be performed before any regression or other statistical analysis are done with the data. It can be done by rescaling the variables using the z-score formula. Standardized variables will then have a mean of 0 and a standard deviation of 1.</p>
<div class="sourceCode" id="cb129"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb129-1"><a href="analysis.html#cb129-1"></a><span class="co"># z-score formula</span></span>
<span id="cb129-2"><a href="analysis.html#cb129-2"></a>get.z.score &lt;-<span class="st"> </span><span class="cf">function</span>(X){</span>
<span id="cb129-3"><a href="analysis.html#cb129-3"></a>  (X<span class="op">-</span><span class="kw">mean</span>(X, <span class="dt">na.rm=</span>T))<span class="op">/</span><span class="kw">sd</span>(X, <span class="dt">na.rm=</span>T)</span>
<span id="cb129-4"><a href="analysis.html#cb129-4"></a>}</span>
<span id="cb129-5"><a href="analysis.html#cb129-5"></a><span class="co"># standardizing the pretest and posttest variables</span></span>
<span id="cb129-6"><a href="analysis.html#cb129-6"></a>Zdata &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">ends_with</span>(<span class="st">&#39;_pre&#39;</span>)<span class="op">|</span><span class="kw">ends_with</span>(<span class="st">&#39;_post&#39;</span>), get.z.score, <span class="dt">.names=</span><span class="st">&#39;Z{col}&#39;</span>))</span>
<span id="cb129-7"><a href="analysis.html#cb129-7"></a>Zdata</span></code></pre></div>
<pre><code>## # A tibble: 1,620 x 19
##    subjID   GWHap GWworry ex_ppgender ex_ppage raceCat ex_ppstaten moral_pre
##     &lt;dbl&gt; &lt;dbl+l&gt; &lt;dbl+l&gt;   &lt;dbl+lbl&gt;    &lt;dbl&gt; &lt;dbl+l&gt;   &lt;dbl+lbl&gt; &lt;dbl+lbl&gt;
##  1    101 7 [I s… 6 [6]    2 [Female]       69 2 [Bla… 36 [Ohio]   4 [4]    
##  2    102 4 [I a… 3 [3]    1 [Male]         30 1 [Whi… 41 [South … 4 [4]    
##  3    103 6 [6]   7 [I a…  2 [Female]       31 1 [Whi… 36 [Ohio]   5 [5]    
##  4    104 7 [I s… 6 [6]    2 [Female]       41 1 [Whi… 43 [Tennes… 7 [Very …
##  5    105 2 [2]   2 [2]    2 [Female]       28 1 [Whi… 14 [Illino… 4 [4]    
##  6    106 5 [5]   4 [4]    2 [Female]       52 1 [Whi… 33 [New Yo… 4 [4]    
##  7    107 5 [5]   6 [6]    1 [Male]         36 4 [His… 36 [Ohio]   7 [Very …
##  8    108 7 [I s… 6 [6]    2 [Female]       19 3 [Oth… 33 [New Yo… 6 [6]    
##  9    109 6 [6]   5 [5]    1 [Male]         21 2 [Bla… 34 [North … 5 [5]    
## 10    110 7 [I s… 5 [5]    1 [Male]         26 1 [Whi… 25 [Missis… 6 [6]    
## # … with 1,610 more rows, and 11 more variables: relig_pre &lt;dbl+lbl&gt;,
## #   health_pre &lt;dbl+lbl&gt;, moral_post &lt;dbl+lbl&gt;, relig_post &lt;dbl+lbl&gt;,
## #   health_post &lt;dbl+lbl&gt;, Zmoral_pre &lt;dbl&gt;, Zrelig_pre &lt;dbl&gt;,
## #   Zhealth_pre &lt;dbl&gt;, Zmoral_post &lt;dbl&gt;, Zrelig_post &lt;dbl&gt;, Zhealth_post &lt;dbl&gt;</code></pre>
</div>
<div id="sample-weighting" class="section level3" number="7.1.2">
<h3><span class="header-section-number">7.1.2</span> Sample weighting</h3>
<p>Per Josep Espaga Reig’s <a href="https://bookdown.org/jespasareig/Book_How_to_weight_a_survey/introduction.html">book</a>, there are 4 steps in survey weighting:</p>
<ul>
<li>Base/design weights: if participants have different probability of being sampled;</li>
<li>Non-response weights: if some participants didn’t respond to the survey;</li>
<li>Use of auxillary data/calibration: adjusting weights to the total population;</li>
<li>Analysis of weight variability/trimming: to check variability in the computed weights;</li>
</ul>
<p>In this example, we will estimate of the percent of US christian population who either believe global warming (GW) is happening or worried about GW. We will give descriptives of the distribution of these two variables and then a simple extrapolation and compute total for the whole US christian population.</p>
<p>Our variables of interest are:</p>
<ul>
<li><strong>GWHap</strong>: On a scale from 1 to 7, how strongly do you believe that global warming is or is not happening?<br />
</li>
<li><strong>GWworry</strong>: How worried are you about global warming?</li>
</ul>
<div id="step-1-design-weights" class="section level4" number="7.1.2.1">
<h4><span class="header-section-number">7.1.2.1</span> Step 1: Design weights</h4>
<p>In the <a href="https://www.researchgate.net/publication/334298965">paper</a>, it is mentionned that participants were recruited via Prime Panels. And only those who previously identified as christians were selected. It should be good to assume that each participants had an equal probability of being sampled. Therefore, <em>we can skip the Step 1 of the weighting</em>. If we had to compute the design weight <span class="math inline">\(d_i\)</span>, it would be equal to the inverse of the probability of being sampled: <span class="math inline">\(1/p_i\)</span>. Per Josep Espaga Reig’s <a href="https://bookdown.org/jespasareig/Book_How_to_weight_a_survey/introduction.html">book</a>: the design weights can be interepreted as “the number of units in our population that each unit in our sample represents. […] The sum of all design weights should be equal to the total number of units in our population”.</p>
</div>
<div id="step-2-non-response-weights" class="section level4" number="7.1.2.2">
<h4><span class="header-section-number">7.1.2.2</span> Step 2: Non-response weights</h4>
<p>The paper also doesn’t mention any information about non-respondent during the survey. So we can assume that there is no bias in the responses and <em>we can skip Step 2</em>. In short, the goal of Step 2 is to account for differences in propensity to respond among the participants. For example, participants from specific neighborhood, income level, etc may have lower response rates, and all the response we have are from a specific demographic groups, which would bias the analysis.</p>
</div>
<div id="step-3-using-auxillary-data-for-weight-calibration" class="section level4" number="7.1.2.3">
<h4><span class="header-section-number">7.1.2.3</span> Step 3: Using auxillary data for weight calibration</h4>
<p>The goal here is to calibrate the survey data to the population in general. So we would need information on both the survey respondents and the population. In this case, we will use demographic variables (gender, education, and race). One of the most common method for calibration weighting is called: <em>raking</em> which we will use as an the example.</p>
<p>We’ll use as auxiliary data the <a href="https://www.pewforum.org/data/">PEW Datasets</a> which gives some statistics of the US christian population. We’ll scrape the data directly from their website so that we’ll have fewer data wrangling to do.</p>
<div class="sourceCode" id="cb131"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb131-1"><a href="analysis.html#cb131-1"></a><span class="co"># PEW data</span></span>
<span id="cb131-2"><a href="analysis.html#cb131-2"></a><span class="co"># getting only the christian respondent and their weights</span></span>
<span id="cb131-3"><a href="analysis.html#cb131-3"></a>pew.data &lt;-<span class="st"> </span><span class="kw">read_sav</span>(<span class="st">&#39;data/pew-data.sav&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-4"><a href="analysis.html#cb131-4"></a><span class="st">  </span><span class="kw">select</span>(RELTRAD, agerec, SEX, racethn, WEIGHT) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-5"><a href="analysis.html#cb131-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.labelled), as_factor)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-6"><a href="analysis.html#cb131-6"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.factor), as.character)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-7"><a href="analysis.html#cb131-7"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb131-8"><a href="analysis.html#cb131-8"></a>    <span class="dt">religion =</span> RELTRAD <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(</span>
<span id="cb131-9"><a href="analysis.html#cb131-9"></a>      <span class="st">`</span><span class="dt">Evangelical Protestant Tradition</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-10"><a href="analysis.html#cb131-10"></a>      <span class="st">`</span><span class="dt">Mainline Protestant Tradition</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-11"><a href="analysis.html#cb131-11"></a>      <span class="st">`</span><span class="dt">Historically Black Protestant Tradition</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-12"><a href="analysis.html#cb131-12"></a>      <span class="st">`</span><span class="dt">Catholic</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-13"><a href="analysis.html#cb131-13"></a>      <span class="st">`</span><span class="dt">Mormon</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-14"><a href="analysis.html#cb131-14"></a>      <span class="st">`</span><span class="dt">Orthodox Christian</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-15"><a href="analysis.html#cb131-15"></a>      <span class="st">`</span><span class="dt">Jehovah&#39;s Witness</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-16"><a href="analysis.html#cb131-16"></a>      <span class="st">`</span><span class="dt">Other Christian</span><span class="st">`</span>=<span class="st">&#39;christian&#39;</span>,</span>
<span id="cb131-17"><a href="analysis.html#cb131-17"></a>      <span class="st">`</span><span class="dt">Jewish</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-18"><a href="analysis.html#cb131-18"></a>      <span class="st">`</span><span class="dt">Muslim</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-19"><a href="analysis.html#cb131-19"></a>      <span class="st">`</span><span class="dt">Buddhist</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-20"><a href="analysis.html#cb131-20"></a>      <span class="st">`</span><span class="dt">Hindu</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-21"><a href="analysis.html#cb131-21"></a>      <span class="st">`</span><span class="dt">Other World Religions</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-22"><a href="analysis.html#cb131-22"></a>      <span class="st">`</span><span class="dt">Other Faiths</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-23"><a href="analysis.html#cb131-23"></a>      <span class="st">`</span><span class="dt">Unaffiliated (religious &quot;nones&quot;)</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-24"><a href="analysis.html#cb131-24"></a>      <span class="st">`</span><span class="dt">Don&#39;t know/refused - no information on religious identity</span><span class="st">`</span>=<span class="st">&#39;other&#39;</span>,</span>
<span id="cb131-25"><a href="analysis.html#cb131-25"></a>    ),</span>
<span id="cb131-26"><a href="analysis.html#cb131-26"></a>    <span class="dt">pew.age =</span> agerec <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(</span>
<span id="cb131-27"><a href="analysis.html#cb131-27"></a>      <span class="st">`</span><span class="dt">Age 24 or younger</span><span class="st">`</span>=<span class="st">&#39;18-29&#39;</span>,</span>
<span id="cb131-28"><a href="analysis.html#cb131-28"></a>      <span class="st">`</span><span class="dt">Age 25-29</span><span class="st">`</span>=<span class="st">&#39;18-29&#39;</span>,</span>
<span id="cb131-29"><a href="analysis.html#cb131-29"></a>      <span class="st">`</span><span class="dt">30-34</span><span class="st">`</span>=<span class="st">&#39;30-49&#39;</span>,</span>
<span id="cb131-30"><a href="analysis.html#cb131-30"></a>      <span class="st">`</span><span class="dt">35-39</span><span class="st">`</span>=<span class="st">&#39;30-49&#39;</span>,</span>
<span id="cb131-31"><a href="analysis.html#cb131-31"></a>      <span class="st">`</span><span class="dt">40-44</span><span class="st">`</span>=<span class="st">&#39;30-49&#39;</span>,</span>
<span id="cb131-32"><a href="analysis.html#cb131-32"></a>      <span class="st">`</span><span class="dt">45-49</span><span class="st">`</span>=<span class="st">&#39;30-49&#39;</span>,</span>
<span id="cb131-33"><a href="analysis.html#cb131-33"></a>      <span class="st">`</span><span class="dt">50-54</span><span class="st">`</span>=<span class="st">&#39;50-64&#39;</span>,</span>
<span id="cb131-34"><a href="analysis.html#cb131-34"></a>      <span class="st">`</span><span class="dt">55-59</span><span class="st">`</span>=<span class="st">&#39;50-64&#39;</span>,</span>
<span id="cb131-35"><a href="analysis.html#cb131-35"></a>      <span class="st">`</span><span class="dt">60-64</span><span class="st">`</span>=<span class="st">&#39;50-64&#39;</span>,</span>
<span id="cb131-36"><a href="analysis.html#cb131-36"></a>      <span class="st">`</span><span class="dt">65-69</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-37"><a href="analysis.html#cb131-37"></a>      <span class="st">`</span><span class="dt">70-74</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-38"><a href="analysis.html#cb131-38"></a>      <span class="st">`</span><span class="dt">75-79</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-39"><a href="analysis.html#cb131-39"></a>      <span class="st">`</span><span class="dt">80-84</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-40"><a href="analysis.html#cb131-40"></a>      <span class="st">`</span><span class="dt">85-89</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-41"><a href="analysis.html#cb131-41"></a>      <span class="st">`</span><span class="dt">Age 90 or older</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span>,</span>
<span id="cb131-42"><a href="analysis.html#cb131-42"></a>      <span class="st">`</span><span class="dt">Don&#39;t know/refused</span><span class="st">`</span>=<span class="st">&#39;NA&#39;</span></span>
<span id="cb131-43"><a href="analysis.html#cb131-43"></a>    ),</span>
<span id="cb131-44"><a href="analysis.html#cb131-44"></a>    <span class="dt">pew.race =</span> racethn <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(</span>
<span id="cb131-45"><a href="analysis.html#cb131-45"></a>      <span class="st">`</span><span class="dt">White non-Hispanic</span><span class="st">`</span>=<span class="st">&#39;White&#39;</span>,</span>
<span id="cb131-46"><a href="analysis.html#cb131-46"></a>      <span class="st">`</span><span class="dt">Black non-Hispanic</span><span class="st">`</span>=<span class="st">&#39;Black&#39;</span>,</span>
<span id="cb131-47"><a href="analysis.html#cb131-47"></a>      <span class="st">`</span><span class="dt">Hispanic</span><span class="st">`</span>=<span class="st">&#39;Hispanic&#39;</span>,</span>
<span id="cb131-48"><a href="analysis.html#cb131-48"></a>      <span class="st">`</span><span class="dt">Other</span><span class="st">`</span>=<span class="st">&#39;Other&#39;</span>,</span>
<span id="cb131-49"><a href="analysis.html#cb131-49"></a>      <span class="st">`</span><span class="dt">Don’t know/Refused (VOL.)</span><span class="st">`</span>=<span class="st">&#39;NA&#39;</span></span>
<span id="cb131-50"><a href="analysis.html#cb131-50"></a>    )</span>
<span id="cb131-51"><a href="analysis.html#cb131-51"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-52"><a href="analysis.html#cb131-52"></a><span class="st">  </span><span class="kw">filter</span>(religion<span class="op">==</span><span class="st">&#39;christian&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-53"><a href="analysis.html#cb131-53"></a><span class="st">  </span><span class="kw">select</span>(SEX, pew.age, pew.race, WEIGHT) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb131-54"><a href="analysis.html#cb131-54"></a><span class="st">  </span><span class="kw">na.omit</span>()</span>
<span id="cb131-55"><a href="analysis.html#cb131-55"></a></span>
<span id="cb131-56"><a href="analysis.html#cb131-56"></a><span class="kw">names</span>(pew.data)[<span class="dv">1</span>] &lt;-<span class="st"> &#39;pew.gender&#39;</span></span>
<span id="cb131-57"><a href="analysis.html#cb131-57"></a></span>
<span id="cb131-58"><a href="analysis.html#cb131-58"></a><span class="kw">head</span>(pew.data,<span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 4
##    pew.gender pew.age pew.race WEIGHT
##    &lt;chr&gt;      &lt;chr&gt;   &lt;chr&gt;     &lt;dbl&gt;
##  1 Female     65+     White     0.438
##  2 Female     65+     White     0.384
##  3 Female     50-64   White     0.663
##  4 Female     30-49   Hispanic  1.64 
##  5 Female     50-64   White     0.357
##  6 Female     65+     Black     0.664
##  7 Female     65+     White     1.42 
##  8 Male       30-49   White     0.388
##  9 Male       65+     Other     0.238
## 10 Female     30-49   White     0.882</code></pre>
<div class="sourceCode" id="cb133"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb133-1"><a href="analysis.html#cb133-1"></a>pew.gender_age &lt;-<span class="st"> </span>pew.data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-2"><a href="analysis.html#cb133-2"></a><span class="st">  </span><span class="kw">select</span>(pew.age, pew.gender, WEIGHT) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-3"><a href="analysis.html#cb133-3"></a><span class="st">  </span><span class="kw">group_by</span>(pew.gender, pew.age) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">sum</span>(WEIGHT)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-4"><a href="analysis.html#cb133-4"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from=</span>pew.age, <span class="dt">values_from=</span>n) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-5"><a href="analysis.html#cb133-5"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span><span class="st">`</span><span class="dt">NA</span><span class="st">`</span>)</span>
<span id="cb133-6"><a href="analysis.html#cb133-6"></a></span>
<span id="cb133-7"><a href="analysis.html#cb133-7"></a>pew.race &lt;-<span class="st"> </span>pew.data <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(pew.race, WEIGHT) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-8"><a href="analysis.html#cb133-8"></a><span class="st">  </span><span class="kw">group_by</span>(pew.race) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">summarise</span>(<span class="dt">n=</span><span class="kw">sum</span>(WEIGHT)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb133-9"><a href="analysis.html#cb133-9"></a><span class="st">  </span><span class="kw">filter</span>(pew.race<span class="op">!=</span><span class="st">&#39;NA&#39;</span>)</span></code></pre></div>
<p>Now we’ll recode our age and race variables to match the PEW data.</p>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb134-1"><a href="analysis.html#cb134-1"></a><span class="co"># interaction between gender and age</span></span>
<span id="cb134-2"><a href="analysis.html#cb134-2"></a>our_data.recoded &lt;-<span class="st"> </span>data <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-3"><a href="analysis.html#cb134-3"></a><span class="st">  </span><span class="kw">select</span>(ex_ppage, ex_ppgender, raceCat) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-4"><a href="analysis.html#cb134-4"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.labelled), as_factor)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-5"><a href="analysis.html#cb134-5"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb134-6"><a href="analysis.html#cb134-6"></a>    <span class="dt">age_group=</span><span class="kw">cut</span>(ex_ppage <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">as.numeric</span>(), <span class="dt">breaks=</span><span class="kw">c</span>(<span class="dv">18</span>, <span class="dv">30</span>, <span class="dv">50</span>, <span class="dv">65</span>, <span class="dv">100</span>), <span class="dt">right=</span>F)</span>
<span id="cb134-7"><a href="analysis.html#cb134-7"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-8"><a href="analysis.html#cb134-8"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="kw">across</span>(<span class="kw">where</span>(is.factor), as.character)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-9"><a href="analysis.html#cb134-9"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb134-10"><a href="analysis.html#cb134-10"></a>    <span class="dt">age_group=</span>age_group <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(</span>
<span id="cb134-11"><a href="analysis.html#cb134-11"></a>      <span class="st">`</span><span class="dt">[18,30)</span><span class="st">`</span>=<span class="st">&#39;18-29&#39;</span>,</span>
<span id="cb134-12"><a href="analysis.html#cb134-12"></a>      <span class="st">`</span><span class="dt">[30,50)</span><span class="st">`</span>=<span class="st">&#39;30-49&#39;</span>,</span>
<span id="cb134-13"><a href="analysis.html#cb134-13"></a>      <span class="st">`</span><span class="dt">[50,65)</span><span class="st">`</span>=<span class="st">&#39;50-64&#39;</span>,</span>
<span id="cb134-14"><a href="analysis.html#cb134-14"></a>      <span class="st">`</span><span class="dt">[65,100)</span><span class="st">`</span>=<span class="st">&#39;65+&#39;</span></span>
<span id="cb134-15"><a href="analysis.html#cb134-15"></a>    ),</span>
<span id="cb134-16"><a href="analysis.html#cb134-16"></a>    <span class="dt">race_cat=</span>raceCat <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">recode</span>(</span>
<span id="cb134-17"><a href="analysis.html#cb134-17"></a>      <span class="st">`</span><span class="dt">White Non-hispanic</span><span class="st">`</span>=<span class="st">&#39;White&#39;</span>,</span>
<span id="cb134-18"><a href="analysis.html#cb134-18"></a>      <span class="st">`</span><span class="dt">Black Non-hispanic</span><span class="st">`</span>=<span class="st">&#39;Black&#39;</span>,</span>
<span id="cb134-19"><a href="analysis.html#cb134-19"></a>      <span class="st">`</span><span class="dt">Hispanic</span><span class="st">`</span>=<span class="st">&#39;Hispanic&#39;</span>,</span>
<span id="cb134-20"><a href="analysis.html#cb134-20"></a>      <span class="st">`</span><span class="dt">Other Non-hispanic</span><span class="st">`</span>=<span class="st">&#39;Other&#39;</span>,</span>
<span id="cb134-21"><a href="analysis.html#cb134-21"></a>      <span class="st">`</span><span class="dt">Two+ races non-hispanic</span><span class="st">`</span>=<span class="st">&#39;Other&#39;</span></span>
<span id="cb134-22"><a href="analysis.html#cb134-22"></a>    )</span>
<span id="cb134-23"><a href="analysis.html#cb134-23"></a>  ) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-24"><a href="analysis.html#cb134-24"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">unite</span>(<span class="dt">col=</span>gender_age, ex_ppgender, age_group, <span class="dt">remove=</span>F) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-25"><a href="analysis.html#cb134-25"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">gender_age=</span><span class="kw">replace</span>(<span class="dt">x=</span>gender_age, <span class="dt">list=</span>gender_age <span class="op">%in%</span><span class="st"> </span><span class="kw">c</span>(<span class="st">&#39;Female_NA&#39;</span>, <span class="st">&#39;Male_NA&#39;</span>), <span class="dt">values=</span><span class="ot">NA</span>)) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-26"><a href="analysis.html#cb134-26"></a><span class="st">  </span><span class="kw">na.omit</span>()</span>
<span id="cb134-27"><a href="analysis.html#cb134-27"></a></span>
<span id="cb134-28"><a href="analysis.html#cb134-28"></a><span class="co"># number of participants/weights by units</span></span>
<span id="cb134-29"><a href="analysis.html#cb134-29"></a><span class="co"># this would be the sum of the final weights from Step 1 and 2 if they were necessary</span></span>
<span id="cb134-30"><a href="analysis.html#cb134-30"></a>our_data.gender_age &lt;-<span class="st"> </span>our_data.recoded <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-31"><a href="analysis.html#cb134-31"></a><span class="st">  </span><span class="kw">group_by</span>(age_group, ex_ppgender) <span class="op">%&gt;%</span></span>
<span id="cb134-32"><a href="analysis.html#cb134-32"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>()) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-33"><a href="analysis.html#cb134-33"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_wider</span>(<span class="dt">names_from=</span>age_group, <span class="dt">values_from=</span>n)</span>
<span id="cb134-34"><a href="analysis.html#cb134-34"></a></span>
<span id="cb134-35"><a href="analysis.html#cb134-35"></a>our_data.race &lt;-<span class="st"> </span>our_data.recoded <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb134-36"><a href="analysis.html#cb134-36"></a><span class="st">  </span><span class="kw">group_by</span>(race_cat) <span class="op">%&gt;%</span></span>
<span id="cb134-37"><a href="analysis.html#cb134-37"></a><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">n =</span> <span class="kw">n</span>())</span>
<span id="cb134-38"><a href="analysis.html#cb134-38"></a></span>
<span id="cb134-39"><a href="analysis.html#cb134-39"></a><span class="kw">rm</span>(<span class="dt">list=</span><span class="kw">setdiff</span>(<span class="kw">ls</span>(), <span class="kw">c</span>(<span class="st">&#39;data&#39;</span>, <span class="st">&#39;data.variables&#39;</span>, <span class="st">&#39;Zdata&#39;</span>, <span class="st">&#39;pew.data&#39;</span>, <span class="st">&#39;pew.gender_age&#39;</span>, <span class="st">&#39;pew.race&#39;</span>, <span class="st">&#39;our_data.recoded&#39;</span>, <span class="st">&#39;our_data.gender_age&#39;</span>, <span class="st">&#39;our_data.race&#39;</span>)))</span></code></pre></div>
<p>Now, we’ll scale the PEW data to our sample size.</p>
<div class="sourceCode" id="cb135"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb135-1"><a href="analysis.html#cb135-1"></a><span class="co"># our total (weighted) observations</span></span>
<span id="cb135-2"><a href="analysis.html#cb135-2"></a>our_data.wgt &lt;-<span class="st"> </span><span class="kw">nrow</span>(our_data.recoded)</span>
<span id="cb135-3"><a href="analysis.html#cb135-3"></a></span>
<span id="cb135-4"><a href="analysis.html#cb135-4"></a><span class="co"># scaling PEW to our data</span></span>
<span id="cb135-5"><a href="analysis.html#cb135-5"></a><span class="co"># for age and gender</span></span>
<span id="cb135-6"><a href="analysis.html#cb135-6"></a>pew.gender_age.scaled &lt;-<span class="st"> </span>pew.gender_age <span class="op">%&gt;%</span></span>
<span id="cb135-7"><a href="analysis.html#cb135-7"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">pivot_longer</span>(<span class="op">-</span>pew.gender, <span class="dt">names_to=</span><span class="st">&#39;pew.age&#39;</span>, <span class="dt">values_to=</span><span class="st">&#39;WEIGHT&#39;</span>) <span class="op">%&gt;%</span></span>
<span id="cb135-8"><a href="analysis.html#cb135-8"></a><span class="st">  </span>tidyr<span class="op">::</span><span class="kw">unite</span>(<span class="dt">col=</span>gender_age, pew.gender, pew.age)</span>
<span id="cb135-9"><a href="analysis.html#cb135-9"></a></span>
<span id="cb135-10"><a href="analysis.html#cb135-10"></a>total.pew &lt;-<span class="st"> </span>pew.gender_age.scaled<span class="op">$</span>WEIGHT <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">sum</span>()</span>
<span id="cb135-11"><a href="analysis.html#cb135-11"></a></span>
<span id="cb135-12"><a href="analysis.html#cb135-12"></a>pew.gender_age.scaled <span class="op">%&lt;&gt;%</span></span>
<span id="cb135-13"><a href="analysis.html#cb135-13"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Freq =</span> <span class="kw">round</span>(WEIGHT<span class="op">/</span>total.pew <span class="op">*</span><span class="st"> </span>our_data.wgt, <span class="dv">0</span>) ) <span class="op">%&gt;%</span></span>
<span id="cb135-14"><a href="analysis.html#cb135-14"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>WEIGHT)</span>
<span id="cb135-15"><a href="analysis.html#cb135-15"></a></span>
<span id="cb135-16"><a href="analysis.html#cb135-16"></a>pew.gender_age.scaled</span></code></pre></div>
<pre><code>## # A tibble: 8 x 2
##   gender_age    Freq
##   &lt;chr&gt;        &lt;dbl&gt;
## 1 Female_18-29   149
## 2 Female_30-49   289
## 3 Female_50-64   250
## 4 Female_65+     197
## 5 Male_18-29     131
## 6 Male_30-49     245
## 7 Male_50-64     218
## 8 Male_65+       141</code></pre>
<div class="sourceCode" id="cb137"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb137-1"><a href="analysis.html#cb137-1"></a><span class="co"># for race</span></span>
<span id="cb137-2"><a href="analysis.html#cb137-2"></a>pew.race.scaled &lt;-<span class="st"> </span>pew.race <span class="op">%&gt;%</span></span>
<span id="cb137-3"><a href="analysis.html#cb137-3"></a><span class="st">  </span><span class="kw">mutate</span>(</span>
<span id="cb137-4"><a href="analysis.html#cb137-4"></a>    <span class="dt">Freq =</span> <span class="kw">round</span>(n<span class="op">/</span>total.pew <span class="op">*</span><span class="st"> </span>our_data.wgt, <span class="dv">0</span>),</span>
<span id="cb137-5"><a href="analysis.html#cb137-5"></a>    <span class="dt">race_cat=</span>pew.race</span>
<span id="cb137-6"><a href="analysis.html#cb137-6"></a>  ) <span class="op">%&gt;%</span></span>
<span id="cb137-7"><a href="analysis.html#cb137-7"></a><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>n, <span class="op">-</span>pew.race)</span>
<span id="cb137-8"><a href="analysis.html#cb137-8"></a></span>
<span id="cb137-9"><a href="analysis.html#cb137-9"></a>pew.race.scaled</span></code></pre></div>
<pre><code>## # A tibble: 4 x 2
##    Freq race_cat
##   &lt;dbl&gt; &lt;chr&gt;   
## 1   209 Black   
## 2   262 Hispanic
## 3    85 Other   
## 4  1071 White</code></pre>
<p><strong>Implementing calibration</strong>
We’ll use the same procedure explained in this <a href="https://bookdown.org/jespasareig/Book_How_to_weight_a_survey/calibration.html">book</a> which uses the <code>survey</code> package.</p>
<div class="sourceCode" id="cb139"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb139-1"><a href="analysis.html#cb139-1"></a><span class="co"># No weights or probabilities supplied, assuming equal probability</span></span>
<span id="cb139-2"><a href="analysis.html#cb139-2"></a>our.svydesign &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> <span class="op">~</span><span class="st"> </span><span class="dv">0</span>, <span class="dt">data=</span>our_data.recoded)</span>
<span id="cb139-3"><a href="analysis.html#cb139-3"></a></span>
<span id="cb139-4"><a href="analysis.html#cb139-4"></a><span class="co"># the variable used for calibration are: gender/age interaction and race</span></span>
<span id="cb139-5"><a href="analysis.html#cb139-5"></a>our.raked &lt;-<span class="st"> </span><span class="kw">rake</span>(our.svydesign, <span class="dt">sample.margins =</span> <span class="kw">list</span>(<span class="op">~</span>race_cat, <span class="op">~</span>gender_age), <span class="dt">population =</span> <span class="kw">list</span>(pew.race.scaled, pew.gender_age.scaled))</span>
<span id="cb139-6"><a href="analysis.html#cb139-6"></a></span>
<span id="cb139-7"><a href="analysis.html#cb139-7"></a><span class="co"># collecting the weights</span></span>
<span id="cb139-8"><a href="analysis.html#cb139-8"></a>raked.weight &lt;-<span class="st"> </span>our.raked<span class="op">$</span>postStrata[[<span class="dv">1</span>]][[<span class="dv">1</span>]] <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">attributes</span>() <span class="op">%&gt;%</span><span class="st"> </span>.[[<span class="st">&quot;weights&quot;</span>]]</span>
<span id="cb139-9"><a href="analysis.html#cb139-9"></a>weighted_data &lt;-<span class="st"> </span>our_data.recoded</span>
<span id="cb139-10"><a href="analysis.html#cb139-10"></a>weighted_data<span class="op">$</span>raked.weight &lt;-<span class="st"> </span>raked.weight</span>
<span id="cb139-11"><a href="analysis.html#cb139-11"></a></span>
<span id="cb139-12"><a href="analysis.html#cb139-12"></a><span class="kw">head</span>(weighted_data, <span class="dv">10</span>)</span></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##    ex_ppage gender_age  ex_ppgender raceCat      age_group race_cat raked.weight
##       &lt;dbl&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;chr&gt;        &lt;chr&gt;     &lt;chr&gt;           &lt;dbl&gt;
##  1       69 Female_65+  Female      Black Non-h… 65+       Black           2.11 
##  2       30 Male_30-49  Male        White Non-h… 30-49     White           0.959
##  3       31 Female_30-… Female      White Non-h… 30-49     White           0.688
##  4       41 Female_30-… Female      White Non-h… 30-49     White           0.688
##  5       28 Female_18-… Female      White Non-h… 18-29     White           0.361
##  6       52 Female_50-… Female      White Non-h… 50-64     White           0.875
##  7       36 Male_30-49  Male        Hispanic     30-49     Hispanic        2.41 
##  8       19 Female_18-… Female      Other Non-h… 18-29     Other           0.531
##  9       21 Male_18-29  Male        Black Non-h… 18-29     Black           1.29 
## 10       26 Male_18-29  Male        White Non-h… 18-29     White           0.945</code></pre>
</div>
</div>
</div>
<div id="working-with-covid-19-data" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> Working with COVID-19 data</h2>
<p>In this example, we’ll use daily updated data from the <a href="https://coronavirus.jhu.edu/data">JHU Covid Resource Center</a> to create animated time series of coronavirus cases and deaths in the US.</p>
<p>The data is available in <a href="https://github.com/CSSEGISandData/COVID-19/tree/master/csse_covid_19_data">their GitHub</a>. We’ll use the daily report for the US from 04-12-2020 to 06-22-2020.</p>
<div class="sourceCode" id="cb141"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb141-1"><a href="analysis.html#cb141-1"></a>repo.url &lt;-<span class="st"> &#39;https://raw.githubusercontent.com/CSSEGISandData/COVID-19/master/csse_covid_19_data/csse_covid_19_daily_reports_us/&#39;</span></span>
<span id="cb141-2"><a href="analysis.html#cb141-2"></a></span>
<span id="cb141-3"><a href="analysis.html#cb141-3"></a><span class="co"># importing all csv</span></span>
<span id="cb141-4"><a href="analysis.html#cb141-4"></a>us.covid.files &lt;-<span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb141-5"><a href="analysis.html#cb141-5"></a>date.format &lt;-<span class="st"> &#39;%m-%d-%Y&#39;</span></span>
<span id="cb141-6"><a href="analysis.html#cb141-6"></a>dates &lt;-<span class="st"> </span><span class="kw">format</span>(<span class="kw">seq</span>(<span class="kw">as.Date</span>(<span class="st">&#39;2020/04/12&#39;</span>), <span class="kw">as.Date</span>(<span class="kw">as.Date</span>(<span class="st">&#39;2020/06/22&#39;</span>)), <span class="dt">by=</span><span class="st">&#39;day&#39;</span>), date.format)</span>
<span id="cb141-7"><a href="analysis.html#cb141-7"></a>i &lt;-<span class="st"> </span><span class="dv">1</span></span>
<span id="cb141-8"><a href="analysis.html#cb141-8"></a><span class="cf">for</span> (date <span class="cf">in</span> dates){</span>
<span id="cb141-9"><a href="analysis.html#cb141-9"></a>  us.covid.files[[i]] &lt;-<span class="st"> </span><span class="kw">read.csv</span>(<span class="kw">url</span>(<span class="kw">paste0</span>(repo.url, date, <span class="st">&#39;.csv&#39;</span>))) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-10"><a href="analysis.html#cb141-10"></a><span class="st">    </span><span class="kw">select</span>(Province_State, Confirmed, Deaths, Recovered, Mortality_Rate) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb141-11"><a href="analysis.html#cb141-11"></a><span class="st">    </span><span class="kw">mutate</span>(<span class="dt">Date=</span><span class="kw">as.Date</span>(date, date.format), <span class="dt">Confirmed.rank=</span><span class="kw">rank</span>(<span class="op">-</span>Confirmed),</span>
<span id="cb141-12"><a href="analysis.html#cb141-12"></a>           <span class="dt">Deaths.rank=</span><span class="kw">rank</span>(<span class="op">-</span>Deaths), <span class="dt">Mortality.rank=</span><span class="kw">rank</span>(<span class="op">-</span>Mortality_Rate))</span>
<span id="cb141-13"><a href="analysis.html#cb141-13"></a>  i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></span>
<span id="cb141-14"><a href="analysis.html#cb141-14"></a>}</span>
<span id="cb141-15"><a href="analysis.html#cb141-15"></a><span class="kw">head</span>(us.covid.files[[<span class="dv">1</span>]])</span></code></pre></div>
<pre><code>##   Province_State Confirmed Deaths Recovered Mortality_Rate       Date
## 1        Alabama      3563     93        NA       2.610160 2020-04-12
## 2         Alaska       272      8        66       2.941176 2020-04-12
## 3        Arizona      3542    115        NA       3.246753 2020-04-12
## 4       Arkansas      1280     27       367       2.109375 2020-04-12
## 5     California     22795    640        NA       2.812020 2020-04-12
## 6       Colorado      7307    289        NA       3.955112 2020-04-12
##   Confirmed.rank Deaths.rank Mortality.rank
## 1             22          27             33
## 2             51          47             27
## 3             23          21             24
## 4             39          39             43
## 5              6           7             29
## 6             16          14             14</code></pre>
<div class="sourceCode" id="cb143"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb143-1"><a href="analysis.html#cb143-1"></a>us.covid.df &lt;-<span class="st"> </span><span class="kw">do.call</span>(rbind, us.covid.files)</span></code></pre></div>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb144-1"><a href="analysis.html#cb144-1"></a><span class="co"># line series by state</span></span>
<span id="cb144-2"><a href="analysis.html#cb144-2"></a>last.df &lt;-<span class="st"> </span>us.covid.files[[<span class="kw">length</span>(us.covid.files)]]</span>
<span id="cb144-3"><a href="analysis.html#cb144-3"></a></span>
<span id="cb144-4"><a href="analysis.html#cb144-4"></a>us.covid.plot &lt;-<span class="st"> </span><span class="kw">ggplot</span>(us.covid.df <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(Confirmed.rank <span class="op">&lt;=</span><span class="dv">10</span>), </span>
<span id="cb144-5"><a href="analysis.html#cb144-5"></a>                        <span class="kw">aes</span>(<span class="dt">y=</span>Confirmed.rank, <span class="dt">group=</span>Province_State, <span class="dt">fill=</span>Province_State)) <span class="op">+</span></span>
<span id="cb144-6"><a href="analysis.html#cb144-6"></a><span class="st">  </span><span class="kw">geom_tile</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Confirmed<span class="op">/</span><span class="dv">2</span>, <span class="dt">width=</span>Confirmed, <span class="dt">height=</span><span class="fl">0.9</span>), <span class="dt">alpha=</span><span class="fl">0.8</span>, <span class="dt">color=</span><span class="ot">NA</span>) <span class="op">+</span></span>
<span id="cb144-7"><a href="analysis.html#cb144-7"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span><span class="dv">0</span>, <span class="dt">label=</span><span class="kw">paste</span>(Province_State, <span class="st">&#39; &#39;</span>)), <span class="dt">hjust=</span><span class="dv">1</span>, <span class="dt">vjust=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb144-8"><a href="analysis.html#cb144-8"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="kw">aes</span>(<span class="dt">x=</span>Confirmed, <span class="dt">label=</span><span class="kw">paste0</span>(<span class="st">&#39;  &#39;</span>, <span class="kw">round</span>(Confirmed<span class="op">/</span><span class="dv">1000</span>), <span class="st">&#39;k&#39;</span>)), <span class="dt">hjust=</span><span class="dv">0</span>) <span class="op">+</span></span>
<span id="cb144-9"><a href="analysis.html#cb144-9"></a><span class="st">  </span><span class="kw">scale_y_reverse</span>() <span class="op">+</span><span class="st"> </span><span class="kw">coord_cartesian</span>(<span class="dt">clip=</span><span class="st">&#39;off&#39;</span>) <span class="op">+</span><span class="st"> </span></span>
<span id="cb144-10"><a href="analysis.html#cb144-10"></a><span class="st">  </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb144-11"><a href="analysis.html#cb144-11"></a><span class="st">  </span><span class="co"># custom ggtheme</span></span>
<span id="cb144-12"><a href="analysis.html#cb144-12"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&#39;none&#39;</span>, <span class="dt">axis.line=</span><span class="kw">element_blank</span>(), </span>
<span id="cb144-13"><a href="analysis.html#cb144-13"></a>        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(), <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),</span>
<span id="cb144-14"><a href="analysis.html#cb144-14"></a>        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(), <span class="dt">panel.grid.major.y=</span><span class="kw">element_blank</span>(),</span>
<span id="cb144-15"><a href="analysis.html#cb144-15"></a>        <span class="dt">panel.grid.minor.y=</span><span class="kw">element_blank</span>(), <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),</span>
<span id="cb144-16"><a href="analysis.html#cb144-16"></a>        <span class="dt">plot.margin =</span> <span class="kw">margin</span>(<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="st">&#39;cm&#39;</span>))</span>
<span id="cb144-17"><a href="analysis.html#cb144-17"></a>  </span>
<span id="cb144-18"><a href="analysis.html#cb144-18"></a>us.covid.anim &lt;-<span class="st"> </span>us.covid.plot <span class="op">+</span><span class="st"> </span><span class="kw">transition_states</span>(Date, <span class="dt">transition_length=</span><span class="dv">4</span>, <span class="dt">state_length=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb144-19"><a href="analysis.html#cb144-19"></a><span class="st">  </span><span class="kw">view_follow</span>(<span class="dt">fixed_x=</span>T)  <span class="op">+</span></span>
<span id="cb144-20"><a href="analysis.html#cb144-20"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Daily coronavirus cases : {closest_state}&#39;</span>,  </span>
<span id="cb144-21"><a href="analysis.html#cb144-21"></a>       <span class="dt">subtitle  =</span>  <span class="st">&#39;Top 10 States&#39;</span>,</span>
<span id="cb144-22"><a href="analysis.html#cb144-22"></a>       <span class="dt">caption  =</span><span class="st">&#39;Data Source: Johns Hopkins Coronavirus Resource Center&#39;</span>)</span>
<span id="cb144-23"><a href="analysis.html#cb144-23"></a></span>
<span id="cb144-24"><a href="analysis.html#cb144-24"></a><span class="co"># animate(us.covid.anim, nframes=400, fps=10, renderer=gifski_renderer(&#39;images/us-covid-rank.gif&#39;))</span></span></code></pre></div>
<div class="figure">
<img src="images/us-covid-rank.gif" alt="" />
<p class="caption">us-covid-rank</p>
</div>
<p>The previous animated plot shows the the evolution of the number of cases. And changing to other variables such as <code>Mortality_Rate</code> or <code>Deaths</code> would follow the same steps.</p>
<p>Now, if instead we want to show how the evolution of case change over space, we can do mapping instead.</p>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb145-1"><a href="analysis.html#cb145-1"></a><span class="kw">library</span>(sf)</span>
<span id="cb145-2"><a href="analysis.html#cb145-2"></a><span class="co"># first we&#39;ll join with a geometry feature of the US</span></span>
<span id="cb145-3"><a href="analysis.html#cb145-3"></a>us.states.geo &lt;-<span class="st"> </span><span class="kw">read_sf</span>(<span class="st">&#39;data/us-states/us-states.shp&#39;</span>)</span>
<span id="cb145-4"><a href="analysis.html#cb145-4"></a><span class="co"># adding geometry</span></span>
<span id="cb145-5"><a href="analysis.html#cb145-5"></a>us.covid.sf &lt;-<span class="st"> </span>us.states.geo <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">right_join</span>(us.covid.df, <span class="dt">by=</span><span class="kw">c</span>(<span class="st">&#39;state_name&#39;</span>=<span class="st">&#39;Province_State&#39;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb146"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb146-1"><a href="analysis.html#cb146-1"></a><span class="co"># mapping</span></span>
<span id="cb146-2"><a href="analysis.html#cb146-2"></a>max_val &lt;-<span class="st"> </span><span class="kw">max</span>(us.covid.df<span class="op">$</span>Mortality_Rate)</span>
<span id="cb146-3"><a href="analysis.html#cb146-3"></a>mid_val &lt;-<span class="st"> </span><span class="kw">mean</span>(us.covid.df<span class="op">$</span>Mortality_Rate)</span>
<span id="cb146-4"><a href="analysis.html#cb146-4"></a>map &lt;-<span class="st"> </span><span class="kw">ggplot</span>(us.covid.sf) <span class="op">+</span></span>
<span id="cb146-5"><a href="analysis.html#cb146-5"></a><span class="st">  </span><span class="kw">geom_sf</span>(<span class="kw">aes</span>(<span class="dt">fill=</span>Mortality_Rate), <span class="dt">size=</span>.<span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb146-6"><a href="analysis.html#cb146-6"></a><span class="st">  </span><span class="kw">scale_fill_gradient2</span>(<span class="dt">high=</span><span class="st">&#39;#6E2C00&#39;</span>, <span class="dt">mid=</span><span class="st">&#39;#FDFEFE&#39;</span>, <span class="dt">low=</span><span class="st">&#39;#28B463&#39;</span>, <span class="dt">midpoint=</span>mid_val, <span class="dt">limits =</span> <span class="kw">c</span>(<span class="dv">0</span>,max_val)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb146-7"><a href="analysis.html#cb146-7"></a><span class="st">  </span><span class="kw">coord_sf</span>(<span class="dt">crs=</span><span class="dv">5070</span>) <span class="op">+</span><span class="st"> </span><span class="kw">theme_bw</span>() <span class="op">+</span></span>
<span id="cb146-8"><a href="analysis.html#cb146-8"></a><span class="st">  </span><span class="co"># custom ggtheme</span></span>
<span id="cb146-9"><a href="analysis.html#cb146-9"></a><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position=</span><span class="st">&#39;bottom&#39;</span>, <span class="dt">axis.line=</span><span class="kw">element_blank</span>(),</span>
<span id="cb146-10"><a href="analysis.html#cb146-10"></a>        <span class="dt">axis.title=</span><span class="kw">element_blank</span>(), <span class="dt">axis.ticks=</span><span class="kw">element_blank</span>(),</span>
<span id="cb146-11"><a href="analysis.html#cb146-11"></a>        <span class="dt">axis.text=</span><span class="kw">element_blank</span>(), <span class="dt">panel.grid.major.y=</span><span class="kw">element_blank</span>(),</span>
<span id="cb146-12"><a href="analysis.html#cb146-12"></a>        <span class="dt">panel.grid.minor.y=</span><span class="kw">element_blank</span>(), <span class="dt">panel.border=</span><span class="kw">element_blank</span>(),</span>
<span id="cb146-13"><a href="analysis.html#cb146-13"></a>        <span class="dt">plot.margin =</span> <span class="kw">margin</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="st">&#39;cm&#39;</span>))</span>
<span id="cb146-14"><a href="analysis.html#cb146-14"></a></span>
<span id="cb146-15"><a href="analysis.html#cb146-15"></a>map.anim &lt;-<span class="st"> </span>map <span class="op">+</span><span class="st"> </span><span class="kw">transition_states</span>(Date, <span class="dt">transition_length=</span><span class="dv">4</span>, <span class="dt">state_length=</span><span class="dv">1</span>) <span class="op">+</span></span>
<span id="cb146-16"><a href="analysis.html#cb146-16"></a><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&#39;Daily coronavirus cases : {closest_state}&#39;</span>,</span>
<span id="cb146-17"><a href="analysis.html#cb146-17"></a>       <span class="dt">caption  =</span><span class="st">&#39;Data Source: Johns Hopkins Coronavirus Resource Center&#39;</span>)</span>
<span id="cb146-18"><a href="analysis.html#cb146-18"></a></span>
<span id="cb146-19"><a href="analysis.html#cb146-19"></a><span class="co"># animate(map.anim, nframes=100, fps=5, renderer=gifski_renderer(&#39;images/us-covid-map.gif&#39;))</span></span></code></pre></div>
<div class="figure">
<img src="images/us-covid-map.gif" alt="" />
<p class="caption">us-covid-map</p>
</div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="spatial.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="resources.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/rajaoberison/edsy/edit/master/07-analysis.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["edsy.pdf", "edsy.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
